<div class="container-fluid">
  <section class="row pt-2">
    <div class="row d-flex justify-content-around">
      <div class="row text-light">
        <div class="col-xl-3 col-lg-6 col-md-6 col-6 justify-content-center">
          <!-- Card -->
          <div class="card mb-4">
            <!-- Card body -->
            <div class="card-body col1 rounded justify-content-center">
              <div
                class="d-flex align-items-center justify-content-between mb-3 lh-1"
              >
                <div>
                  <span class="fs-6 text-uppercase fw-semi-bold"
                    >Transactions</span
                  >
                  <!-- <i class="fa-solid fa-eye"></i>
                      <i class="fa-duotone fa-eye"></i> -->
                </div>
                <div>
                  <span class="bi bi-shopping-bag fs-3 text-primary"></span>
                </div>
              </div>
              <h2 class="fw-bold mb-1">{{ totalLength }}</h2>
              <h2 class="fw-bold mb-1" *ngIf="!AllOrderData">0</h2>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-lg-6 col-md-6 col-6">
          <!-- Card -->
          <div class="card mb-4">
            <!-- Card body -->
            <div class="card-body rounded col2">
              <div
                class="d-flex align-items-center justify-content-between mb-3 lh-1"
              >
                <div>
                  <!-- <i class="fa-solid fa-face-smile"></i> -->
                  <span class="fs-6 text-uppercase fw-semi-bold">Pending</span>
                </div>
                <div>
                  <!-- <span class="bi bi-book-open fs-3 text-primary"></span> -->
                </div>
              </div>
              <h2 class="fw-bold mb-1" *ngIf="pendingLength">
                {{ pendingLength }}
              </h2>
              <h2 class="fw-bold mb-1" *ngIf="!pending">0</h2>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-lg-6 col-md-6 col-6">
          <!-- Card -->
          <div class="card mb-4">
            <!-- Card body -->
            <div class="card-body col3 rounded">
              <div
                class="d-flex align-items-center justify-content-between mb-3 lh-1"
              >
                <div>
                  <!-- <i class="fa-solid fa-heart"></i> -->
                  <span class="fs-6 text-uppercase fw-semi-bold"
                    >Completed</span
                  >
                </div>
                <div>
                  <!-- <span class="bi bi-users fs-3 text-primary"></span> -->
                </div>
              </div>
              <h2 class="fw-bold mb-1" *ngIf="completedOrder">
                {{ completedOrderLength }}
              </h2>
              <h2 class="fw-bold mb-1" *ngIf="!completedOrder">0</h2>
            </div>
          </div>
        </div>
        <div class="col-xl-3 col-lg-6 col-md-6 col-6">
          <!-- Card -->
          <div class="card mb-4">
            <!-- Card body -->
            <div class="card-body col4 rounded">
              <div
                class="d-flex align-items-center justify-content-between mb-3 lh-1"
              >
                <div>
                  <!-- <i class="fa-solid fa-users-viewfinder"></i> -->
                  <span class="fs-6 text-uppercase fw-semi-bold">Canceled</span>
                </div>
                <div>
                  <span class="bi bi-users fs-3 text-primary"></span>
                </div>
              </div>
              <h2 class="fw-bold mb-1">{{ canceledOrderLength }}</h2>
              <h2 class="fw-bold mb-1" *ngIf="!canceledOrder">0</h2>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <nav class="navbar navbar-light bg-light" *ngIf="AllOrderData">
    <div class="container-fluid">
      <div class="navbar-brand w-100">
        <div class="w-100 d-flex justify-content-between">
          <div
            [class.active]="service == 'completed'"
            class="mat d-none d-lg-block p-2 cursor"
            (click)="service = 'completed'"
          >
            All Transactions
          </div>
          <div
            [class.active]="service == 'completed1'"
            class="mat d-none d-lg-block p-2 cursor"
            (click)="service = 'completed1'"
          >
            Pending Orders
          </div>
          <div
            [class.active]="service == 'completed2'"
            class="mat d-none d-lg-block p-2 cursor"
            (click)="service = 'completed2'"
          >
            Completed Orders
          </div>
          <div
            [class.active]="service == 'completed3'"
            class="mat d-none d-lg-block p-2 cursor"
            (click)="service = 'completed3'"
          >
            Cancel Orders
          </div>
        </div>
      </div>

      <div
        class="navbar-toggler d-lg-none"
        type="button"
        data-bs-toggle="offcanvas"
        data-bs-target="#offcanvasNavbar"
        ardiva-controls="offcanvasNavbar"
      >
        <span class="navbar-toggler-icon"></span>
      </div>
      <h4 class="d-lg-none">SERVICES</h4>
      <div
        class="offcanvas offcanvas-end w-50  mt-5 pt-5"
        tabindex="-1"
        id="offcanvasNavbar"
        aria-labelledby="offcanvasNavbarLabel"
      >
        <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="offcanvasNavbarLabel">SERVICES</h5>
          <button
            type="button"
            class="btn-close text-reset"
            data-bs-dismiss="offcanvas"
            aria-label="Close"
          ></button>
        </div>
        <div class="offcanvas-body">
          <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
            <li
              [class.active]="service == 'completed'"
              class="mat p-2 cursor"
              data-bs-dismiss="offcanvas"
              aria-label="Close"
              (click)="service = 'completed'"
            >
              All Transactions
            </li>
            <li
              [class.active]="service == 'completed1'"
              class="mat p-2 cursor"
              data-bs-dismiss="offcanvas"
              aria-label="Close"
              (click)="service = 'completed1'"
            >
              Pending Orders
            </li>
            <li
              [class.active]="service == 'completed2'"
              class="mat p-2 cursor"
              data-bs-dismiss="offcanvas"
              aria-label="Close"
              (click)="service = 'completed2'"
            >
              Completed Orders
            </li>
            <li
              [class.active]="service == 'completed3'"
              class="mat p-2 cursor"
              data-bs-dismiss="offcanvas"
              aria-label="Close"
              (click)="service = 'completed3'"
            >
              Cancel Orders
            </li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <section>
    <div [ngSwitch]="service" *ngIf="AllOrderData">
      <div class="row d-flex">
        <div class="d-flex col-6">
          <div class="">
            <input
              type="date"
              [(ngModel)]="fromDate1"
              class="me-2"
              placeholder="
                dd/mm/yyyy, --:--
                "
            />
          </div>
          <div class=" ">
            <input
              type="date"
              style="margin-right: 3px"
              [(ngModel)]="toDate1"
              placeholder="
                dd/mm/yyyy, --:--
                "
            />
          </div>
          <div class=" border border-2 d-flex align-center justify-content-center" style="height: 27px; width: 30px; background-color:aliceblue" (click)="filterByDate()"><i class="bi bi-search"></i></div>

          <!-- <div class="col-md-2">
            <button class="btn btn-danger h-75" (click)="filterByDate()">
              Search
            </button>
          </div> -->
        </div>

        <div class=" col-md-3 my-2 my-md-0  ">
          <input class="form-control" type="text" name="search" [(ngModel)]="searchText" autocomplete="off" placeholder="&#61442;  Start searching for Artisans within your location">
        </div>
      </div>

      <!-- all transaction -->
      <div *ngSwitchCase="'completed'" id="no-tables">
        <div>
          <table class="table table-striped">
            <thead>
              <tr>
                <th scope="col">ID</th>
                <th scope="col">Date</th>
                <th>Inspection Date</th>
                <th>Completion Date</th>
                <!-- <th scope="col" (click)="sort('id')" >Order ID&nbsp;<i class="fa fa-sort"></i> </th> -->
                <th scope="col">Issue</th>
                <th scope="col">Location</th>
                <th scope="col">Artisan's Name</th>

                <th scope="col">Status</th>
                <th scope="col">Action</th>
              </tr>
            </thead>
            <tbody class="">
              <tr
                class="align-center justify-content-center w-100"
                *ngFor="
                  let data of filteredOrderData | filter: searchText
                    | paginate: { itemsPerPage: 30, currentPage: allPage }
                "
              >
                <td data-title="Order ID">{{ data.uniqueId }}</td>
                <td data-title=" Date">{{ data.date }}</td>
                <!-- <td data-title="Date">{{data.artisanEmail}}</td> -->
                <td data-title="Inspection Date">{{ data.inspectionDate }}</td>
                <td data-title="Completion Date">{{ data.completionDate }}</td>

                <td data-title="Issue" id="gfg" tooltip="{{ data.issue }}">
                  {{
                    data.issue.length > 6
                      ? (data.issue | slice: 0:10) + "..."
                      : data.issue
                  }}
                </td>
                <td data-title="Location">{{ data.propertyAddress }}</td>
                <!-- <td data-title="Amount">{{data.title}}</td> -->
                <td data-title="Artisan's Name">{{ data.artisanName }}</td>

                <td
                  data-title="Status"
                  *ngIf="data.isCancelled && data.action === 5"
                >
                  Cancel
                </td>
                <td data-title="Status" *ngIf="data.action === 0">Pending</td>
                <td data-title="Status" *ngIf="data.action === 2">Approved</td>
                <td data-title="Status" *ngIf="data.action === 1">Approved</td>
                <td
                  data-title="Status"
                  *ngIf="!data.isCancelled && data.action === 4"
                >
                  Completed
                </td>
                <td data-title="Action">
                  <button
                    class="btn btn-info me-2"
                    (click)="onClickVieworder(data); openModal(template)"
                  >
                    View Order
                  </button>
                  <button
                    class="btn btn-info me-2"
                    (click)="aproveOrder(data)"
                    *ngIf="data.action == 0"
                  >
                    Awaiting Approval
                  </button>
                  <button
                  class="btn btn-danger me-2"
                  (click)="rejectOrder(data)"
                  *ngIf="data.action === 0"
                >
                  Reject Order
                </button>

                  <button class="btn btn-success me-2" *ngIf="data.isApproved">
                    Approved
                  </button>

                  <!-- <button
                    class="btn btn-danger me-2"
                    (click)="rejectOrder(data)"
                    *ngIf="data.action === 5"
                  >
                    Reject Order
                  </button> -->
                  <button class="btn btn-danger me-2" *ngIf="data.isCancelled">
                    Order Rejected
                  </button>
                  <button
                    class="btn btn-success me-2"
                    *ngIf="!data.isCancelled && data.action === 4"
                  >
                    Completed
                  </button>
                  <button
                    class="btn btn-danger"
                    (click)="getArtisanToReassign(data)"
                    *ngIf="data.action === 3"
                  >
                    Re-Assign Artisan
                  </button>
                  <div
                    class="btn btn-danger"
                    *ngIf="assignArtisan && data.action === 3"
                  >
                    <select
                      class="form-select"
                      aria-label="Default select example"
                      (change)="onChangeArtisan($event.target)"
                    >
                      <option value="" selected disabled>Select Artisans</option>
                      <!-- <option *ngFor="let data of assignArtisan"  [ngValue]="data">{{data.firstName}}</option> -->
                      <option
                        *ngFor="let artisan of assignArtisan"
                        value="{{ artisan.id }}"
                      >
                        {{ artisan.firstName }}
                      </option>
                    </select>
                  </div>
                  <!-- <button class="btn btn-primary" (click)="reassignArtisan(data)">submit</button> -->
                </td>
              </tr>
            </tbody>

            <!-- <pagination-controls (pageChange)="page = $event"></pagination-controls> -->
          </table>
          <pagination-controls
            (pageChange)="allPage = $event"
          ></pagination-controls>
        </div>

        <div *ngIf="!filteredOrderData">
          <app-emptycart></app-emptycart>
                  </div>
      </div>

      <!-- pending transaction -->
      <div *ngSwitchCase="'completed1'" id="no-tables">
        <div>
          <table class="table table-striped">
            <thead>
              <tr>
                <th scope="col">ID</th>
                <th scope="col">Date</th>
                <th>Inspection Date</th>
                <th>Completion Date</th>
                <!-- <th scope="col" (click)="sort('id')" >Order ID&nbsp;<i class="fa fa-sort"></i> </th> -->
                <th scope="col">Issue</th>
                <th scope="col">Location</th>
                <th scope="col">Artisan's Name</th>

                <th scope="col">Status</th>
                <th scope="col">Action</th>
              </tr>
            </thead>
            <tbody class="">
              <tr
                class="align-center justify-content-center w-100"
                *ngFor="let data of pending |paginate: { itemsPerPage: 30, currentPage: pendingPage }"
              >
                <td data-title="Order ID">{{ data.uniqueId }}</td>
                <td data-title=" Date">{{ data.date }}</td>
                <!-- <td data-title="Date">{{data.artisanEmail}}</td> -->
                <td data-title="Inspection Date">{{ data.inspectionDate }}</td>
                <td data-title="Completion Date">{{ data.completionDate }}</td>
                <td
                  data-title="Issue"
                  data-title="{{ data.issue }}"
                  class="butt"
                >
                  {{
                    data.issue.length > 6
                      ? (data.issue | slice: 0:10) + "..."
                      : data.issue
                  }}
                </td>
                <td data-title="Location">{{ data.propertyAddress }}</td>
                <!-- <td data-title="Amount">{{data.title}}</td> -->
                <td data-title="Artisan's Name">{{ data.artisanName }}</td>

                <!-- <td data-title="Status" *ngIf="data.isCancelled && data.action === 5">Cancel</td> -->
                <td data-title="Status" *ngIf="data.action === 0">Pending</td>
                <!-- <td data-title="Status" *ngIf=" data.action === 2">Approved</td> -->
                <!-- <td data-title="Status" *ngIf=" data.action === 1">Approved</td> -->
                <!-- <td data-title="Status" *ngIf=" !data.isCancelled && data.action === 4 ">Completed</td> -->
                <td data-title="Action">
                  <button
                    class="btn btn-info me-2"
                    (click)="onClickVieworder(data); openModal(template)"
                  >
                    View Order
                  </button>

                  <button
                    class="btn btn-info me-2"
                    (click)="aproveOrder(data)"
                    *ngIf="!data.isApproved && !data.isCancelled"
                  >
                    Awaiting Approval
                  </button>
                  <button class="btn btn-success me-2" *ngIf="data.isApproved">
                    Approved
                  </button>

                  <button
                    class="btn btn-danger me-2"
                    (click)="rejectOrder(data)"
                    *ngIf="!data.isCancelled && !data.isApproved"
                  >
                    Reject Order
                  </button>
                  <button class="btn btn-danger" *ngIf="data.isCancelled">
                    Order Rejected
                  </button>
                </td>
              </tr>
            </tbody>
          </table>

          <pagination-controls
            (pageChange)="pendingPage = $event"
          ></pagination-controls>

          <div *ngIf="!pending">
            <!-- <div
              class="h1 d-flex align-items-center justify-content-center text-muted"
              style="height: 300px"
            >
              {{ pendingOrderError }}
            </div> -->

            <div *ngIf="!pending">
              <app-emptycart></app-emptycart>
                      </div>
          </div>
        </div>
      </div>

      <!-- completed Transactions -->
      <div *ngSwitchCase="'completed2'" id="no-tables" id="no-tables">
        <div>
          <table class="table table-striped">
            <thead>
              <tr>
                <th scope="col">ID</th>
                <th scope="col">Date</th>
                <th>Inspection Date</th>
                <th>Completion Date</th>
                <!-- <th scope="col" (click)="sort('id')" >Order ID&nbsp;<i class="fa fa-sort"></i> </th> -->
                <th scope="col">Issue</th>
                <th scope="col">Location</th>
                <th scope="col">Artisan's Name</th>

                <th scope="col">Status</th>
                <th scope="col">Action</th>
              </tr>
            </thead>
            <tbody class="">
              <tr
                class="align-center justify-content-center w-100"
                *ngFor="let data of completedOrder |paginate: { itemsPerPage: 30, currentPage: completedPage }"
              >
                <td data-title="Order ID">{{ data.uniqueId }}</td>
                <td data-title=" Date">{{ data.date }}</td>
                <!-- <td data-title="Date">{{data.artisanEmail}}</td> -->
                <td data-title="Inspection Date">{{ data.inspectionDate }}</td>
                <td data-title="Completion Date">{{ data.completionDate }}</td>
                <td
                  data-title="Issue"
                  data-title="{{ data.issue }}"
                  class="butt"
                >
                  {{
                    data.issue.length > 6
                      ? (data.issue | slice: 0:10) + "..."
                      : data.issue
                  }}
                </td>
                <td data-title="Location">{{ data.propertyAddress }}</td>
                <!-- <td data-title="Amount">{{data.title}}</td> -->
                <td data-title="Artisan's Name">{{ data.artisanName }}</td>

                <td data-title="Status" *ngIf="data.action === 4">Completed</td>
                <td data-title="Action">
                  <!-- <button class="btn btn-primary" (click)="reassignArtisan(data)">submit</button> -->
                </td>
              </tr>
            </tbody>

            <!-- <pagination-controls (pageChange)="page = $event"></pagination-controls> -->
          </table>

          <pagination-controls
            (pageChange)="completePage = $event"
          ></pagination-controls>
        </div>
        <div *ngIf="!completedOrder">
          <app-emptycart></app-emptycart>
                  </div>
      </div>

      <!-- cancel orders -->
      <div *ngSwitchCase="'completed3'" id="no-tables" id="no-tables">
        <div>
          <table class="table">
            <thead>
              <tr>
                <th scope="col">Order ID</th>
                <th scope="col">Date</th>
                <th scope="col">Location</th>
                <!-- <th scope="col">Amount</th> -->
                <th scope="col">Status</th>
                <th scope="col">Artisan's Name</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let data of canceledOrder |paginate: { itemsPerPage: 30, currentPage: cancelPage }">
                <td data-title="Order ID" scope="row">{{ data.uniqueId }}</td>
                <td data-title="Date">{{ data.date }}</td>
                <td data-title="Location">{{ data.propertyAddress }}</td>
                <!-- <td data-title="Amount">@mdo</td> -->
                <td data-title="Status">Canceled</td>
                <td data-title="Artisan's Name">{{ data.artisanName }}</td>
              </tr>
            </tbody>
          </table>
          <pagination-controls
            (pageChange)="cancelPage = $event"
          ></pagination-controls>
        </div>
      </div>
    </div>
    <div *ngIf="!AllOrderData">
      <app-emptycart></app-emptycart>
    </div>
  </section>
</div>


<ng-template #template>
  <div class="modal-header">
    <h4 class="modal-title pull-left">ORDER DETAILS</h4>
    <button
      type="button"
      class="btn-close close pull-right"
      aria-label="Close"
      (click)="modalRef?.hide()"
    >
      <span aria-hidden="true" class="visually-hidden">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div>
      <span> Order Date : </span><span class="h6">{{ orderById.date }}</span>
    </div>

    <!-- <button mat-button matRipple class="purple-500 fuse-white-fg mr-12"; (click)="imageSource()">Display</button> -->
    <!-- !-- <button mat-button matRipple class="purple-500 fuse-white-fg mr-12"; (click)="imageSource()">Display</button> -->
    <div
      class="d-flex mb-1"
      *ngFor="let data of orderById.filesBytes; let i = index"
    >
      <img
        class="image-fluid"
        style="height: 100px; width: 100px"
        src="data:image/png;base64,{{ data }}"
        *ngIf="hidden"
      />
    </div>
    <div>
      <span class="me-2">Pictures : </span
      ><span class="h6"
        ><button class="btn btn-info my-2" (click)="imageSource()">
          View Pictures
        </button></span
      >
    </div>

    <div>
      <span>Has Invoice? : </span
      ><span class="h6">{{ orderById.hasInvoice }}</span>
    </div>

    <div>
      <span> Order ID : </span><span class="h6">{{ orderById.uniqueId }}</span>
    </div>

    <div>
      <span>Inspection Date : </span
      ><span class="h6">{{ orderById.inspectionDate }}</span>
    </div>

    <div>
      <span>Job Description : </span
      ><span class="h6">{{ orderById.issue }}</span>
    </div>

    <div>
      <span>Order Name : </span><span class="h6">{{ orderById.name }}</span>
    </div>

    <div>
      <span>Order Phone Number : </span
      ><span class="h6">{{ orderById.orderPhoneNumber }}</span>
    </div>

    <div>
      <span>Order Phone Number : </span
      ><span class="h6">{{ orderById.phoneNumber }}</span>
    </div>

    <div>
      <span> Address : </span
      ><span class="h6">{{ orderById.propertyAddress }}</span>
    </div>

    <div class="mt-3">
      <span> Customer's Email : </span
      ><span class="h6">{{ orderById.customerEmail }}</span>
    </div>

    <div>
      <span> Customer's Name : </span
      ><span class="h6">{{ orderById.customerName }}</span>
    </div>

    <div>
      <span>Customer's Phone Number : </span
      ><span class="h6">{{ orderById.customerPhoneNumber }}</span>
    </div>

    <div class="mt-3">
      Artisan Name : <span></span
      ><span class="h6">{{ orderById.artisanName }}</span>
    </div>

    <div>
      <span>Artisan Email : </span
      ><span class="h6">{{ orderById.artisanEmail }}</span>
    </div>

    <div>
      <span>Artisan ID : </span
      ><span class="h6">{{ orderById.artisanId }}</span>
    </div>

    <div>
      <span>Artisan Address : </span
      ><span class="h6">{{ orderById.artisanLocation }}</span>
    </div>

    <div>
      <span>Artisan Number : </span
      ><span class="h6">{{ orderById.artisanPhoneNumber }}</span>
    </div>

    <!-- <button mat-button matRipple class="purple-500 fuse-white-fg mr-12"; (click)="imageSource()">Display</button> -->
    <img
      class="image-fluid"
      style="height: 100px; width: 100px"
      src="data:image/png;base64,{{ orderById.artisanProfileImage }}"
      *ngIf="hidden2"
    />

    <div>
      <span>Artisan Image : </span
      ><span class="h6"
        ><button class="btn btn-info" (click)="imageSource2()">
          Display
        </button></span
      >
    </div>

    <div>
      <span class="mt-3">Artisan Ratings : </span
      ><ngx-star-rating
        [id]="orderById.artisanRating"
        [(ngModel)]="orderById.artisanRating"
        [disabled]="true"
      ></ngx-star-rating>
    </div>
  </div>

  <button
    type="button"
    class="btn btn-danger"
    aria-label="Close"
    (click)="modalRef?.hide()"
  >
    Close
  </button>
</ng-template>
